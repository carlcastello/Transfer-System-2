{% extends 'transfer-base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Registered Users{% endblock %}

{% block css %}
{% endblock %}


{% block main_content %}
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Registered Users</h1>
    </div>
<!-- /.col-lg-12 -->
</div>

{% if response %}
<div class="row">
    <div class="col-lg-12">
        <div class="alert {{ response.0 }}">
            {{ response.1 |safe  }}
        </div>
    </div>
</div>
{% endif %}

<br>
<div class="row">
    <div class="col-lg-12">
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#add_modal">Add User</button>
    </div>
</div>
<br>
<div class="row">
    {% for user in users %}
        <div class="col-lg-6 col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-user fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">{{ user.username }}</div>
                            <div>{{ user.first_name }} {{ user.last_name }}</div>
                        </div>
                    </div>
                </div>
                <a data-toggle="modal" data-target="#delete_modal" href="#delete_modal" data-object-id="{{ user.pk }}">
                    <div class="panel-footer">
                        <span class="pull-left">Delete User</span>
                        <span class="pull-right"><i class="fa fa-trash"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
    {% endfor %}
</div>

<!-- Add Modal -->
<div id="add_modal" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">User Information</h4>
            </div>
            <form role="form" method="post">
                {% csrf_token %}
                <div class="modal-body ">
                    {% for field in form %}
                    <div class="form-group">
                        <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                        {{ field.error }}
                        {{ field|add_class:"form-control" }}
                    </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" value="save">Save</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="delete_modal" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
            </div>
            <div class="modal-body ">
                Are you sure you want to delete this user?
            </div>
            <div class="modal-footer">
                <a class="btn btn-danger" href="delete/{{ user.pk }}">Delete</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}


{% block javascript %}
<script>
    document.formHasErrors = {% if form.errors %}true{% else %}false{% endif %};
</script>

<script>
    $( document ).ready(function() {
       if (document.formHasErrors) {
           $('#add-modal').modal('toggle');
       }
    });
</script>
{% endblock %}